# LegoCity - Smart City Platform
# @version 1.0
# @author CTU·SematX
# @copyright (c) 2025 CTU·SematX. All rights reserved
# @license MIT License
# @see https://github.com/CTU-SematX/LegoCity The LegoCity GitHub project

services:
  # Traffic Flow Server (FastAPI + Python)
  traffic-flow:
    build:
      context: ./traffic-flow
      dockerfile: Dockerfile
    container_name: legocity-traffic-flow
    ports:
      - "8001:8001"
    environment:
      - BROKER_URL=${BROKER_URL:-http://orion:1026}
      - DATA_PATH=/opendata/traffic.json
      - DATABASE_URL=sqlite:///./traffic.db
    volumes:
      - ../opendata:/opendata:ro
      - traffic-data:/app
    networks:
      - legocity-network
    restart: unless-stopped

  # Environment Monitor Server (Gin + Go)
  environment-monitor:
    build:
      context: ./environment-monitor
      dockerfile: Dockerfile
    container_name: legocity-environment-monitor
    ports:
      - "8002:8002"
    environment:
      - BROKER_URL=${BROKER_URL:-http://orion:1026}
      - DATA_PATH=/opendata/environment.json
      - PORT=8002
    volumes:
      - ../opendata:/opendata:ro
      - environment-data:/app
    networks:
      - legocity-network
    restart: unless-stopped

  # Public Lighting Server (Elysia + Bun)
  public-lighting:
    build:
      context: ./public-lighting
      dockerfile: Dockerfile
    container_name: legocity-public-lighting
    ports:
      - "8003:8003"
    environment:
      - BROKER_URL=${BROKER_URL:-http://orion:1026}
      - DATA_PATH=/opendata/lighting.json
      - PORT=8003
    volumes:
      - ../opendata:/opendata:ro
      - lighting-data:/app
    networks:
      - legocity-network
    restart: unless-stopped

  # Urban Infrastructure Server (Elysia + Bun)
  urban-infra:
    build:
      context: ./urban-infra
      dockerfile: Dockerfile
    container_name: legocity-urban-infra
    ports:
      - "8004:8004"
    environment:
      - BROKER_URL=${BROKER_URL:-http://orion:1026}
      - DATA_PATH=/opendata/infrastructure.json
      - PORT=8004
    volumes:
      - ../opendata:/opendata:ro
      - infra-data:/app
    networks:
      - legocity-network
    restart: unless-stopped

networks:
  legocity-network:
    name: legocity-network
    driver: bridge

volumes:
  traffic-data:
  environment-data:
  lighting-data:
  infra-data:
